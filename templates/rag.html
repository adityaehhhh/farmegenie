<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Enhanced Cohere Chatbot</title>
<style>
  :root {
    --primary-emerald: #10a37f;
    --secondary-teal: #0f8e6b;
    --neutral-slate: #444654;
    --light-pearl: #ececf1;
    --border-radius: 12px;
    --shadow-soft: 0 4px 12px rgba(0,0,0,0.15);
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    display: flex;
    height: 100vh;
    background-color: #343541;
    color: #ffffff;
  }

  .sidebar {
    width: 260px;
    background: var(--secondary-teal);
    border-radius: var(--border-radius);
    color: white;
    box-shadow: var(--shadow-soft);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    padding: 1rem 0.5rem;
  }

  .sidebar button {
    background: var(--primary-emerald);
    color: white;
    padding: 0.75rem;
    border: none;
    border-radius: var(--border-radius);
    font-size: 1rem;
    margin-bottom: 1rem;
    cursor: pointer;
    transition: 0.2s;
  }
  .sidebar button:hover { background: var(--secondary-teal); }

  .chat-history-title {
    font-weight: 600;
    color: rgba(255,255,255,0.95);
    margin-bottom: 0.5rem;
    padding-left: 0.25rem;
  }

  .chat-link {
    background: rgba(255,255,255,0.15);
    padding: 0.6rem;
    margin: 0.25rem 0.25rem;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: 0.18s;
    color: white;
  }

  .chat-link:hover { background: rgba(255,255,255,0.25); transform: translateY(-2px); }

  .main { flex: 1; display: flex; flex-direction: column; }
  .chat-box {
    flex: 1;
    background: var(--light-pearl);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-soft);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    padding: 1rem;
  }

  .chat-entry {
    max-width: 75%;
    padding: 1rem;
    border-radius: var(--border-radius);
    word-wrap: break-word;
    font-size: 1rem;
    animation: fadeIn 0.3s ease-in-out;
  }

  .user { align-self: flex-end; background: var(--primary-emerald); color: white; border-bottom-right-radius: 0; }
  .bot { align-self: flex-start; background: var(--neutral-slate); color: var(--light-pearl); border-bottom-left-radius: 0; }
  .typing { font-style: italic; color: var(--neutral-slate); }

  .input-area {
    display: flex;
    padding: 1rem;
    border-top: 1px solid rgba(0,0,0,0.2);
    background-color: #40414f;
  }

  .input-area input {
    flex: 1;
    border-radius: var(--border-radius);
    border: 1px solid #E2E8F0;
    padding: 0.75rem;
    background-color: #343541;
    color: #fff;
    font-size: 1rem;
  }

  .input-area button {
    border-radius: var(--border-radius);
    font-weight: 600;
    padding: 0.75rem 1rem;
    margin-left: 0.5rem;
    background: var(--primary-emerald);
    color: white;
    border: none;
    cursor: pointer;
    transition: 0.2s;
  }
  .input-area button:hover { background: var(--secondary-teal); }

  @keyframes fadeIn {
    0% { opacity: 0; transform: translateY(5px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  @media(max-width: 992px) {
    body { flex-direction: column; }
    .sidebar { width: 100%; }
  }
</style>
</head>
<body>
  <div class="sidebar">
    <button onclick="newChat()">+ New Chat</button>
    <div class="chat-history-title">Chat History</div>
    <div id="chatList"></div>
  </div>

  <div class="main">
    <div class="chat-box" id="chatBox">
      <div class="chat-entry bot">Hello! Start a new conversation or continue below.</div>
    </div>
    <div class="input-area">
      <input type="text" id="userInput" placeholder="Send a message..." />
      <button onclick="sendMessage()">Send</button>
      <button onclick="startVoiceInput()">ðŸŽ¤</button>
    </div>
  </div>

<script>
const cohereAPIKey = 'F6dudbIR0DQQ17pI3niD0IVWLYk6Di1Wr5fNxV5k';
let chatId = 1;
let chatHistory = [];

function newChat() {
  if (chatHistory.length > 0) {
    const chatList = document.getElementById('chatList');
    const chatItem = document.createElement('div');
    chatItem.className = 'chat-link';
    chatItem.textContent = `Chat ${chatId++}`;
    chatList.appendChild(chatItem);
  }
  document.getElementById('chatBox').innerHTML = `<div class="chat-entry bot">New chat started. How can I help you?</div>`;
  chatHistory = [];
}

function appendMessage(content, sender='bot') {
  const chatBox = document.getElementById('chatBox');
  const entry = document.createElement('div');
  entry.className = `chat-entry ${sender}`;
  entry.innerHTML = content;
  chatBox.appendChild(entry);
  chatBox.scrollTop = chatBox.scrollHeight;
  chatHistory.push({ sender, content });
}

async function sendMessage() {
  const input = document.getElementById('userInput');
  const text = input.value.trim();
  if (!text) return;
  appendMessage(text, 'user');
  input.value = '';

  appendMessage('<span class="typing">Bot is typing...</span>', 'bot');

  // Language detection and translation prompt
  const prompt = `Detect the language of this text and respond in the same language: "${text}"`;

  const res = await fetch("https://api.cohere.ai/v1/generate", {
    method: "POST",
    headers: {
      "Authorization": `Bearer ${cohereAPIKey}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model: "command-r-plus",
      prompt: prompt,
      max_tokens: 300,
      temperature: 0.7
    })
  });

  const data = await res.json();
  let botResponse = data.generations?.[0]?.text.trim() || "Sorry, I didnâ€™t get that.";

  // Remove typing indicator
  const chatBox = document.getElementById('chatBox');
  const entries = chatBox.getElementsByClassName('chat-entry');
  const lastEntry = entries[entries.length - 1];
  if (lastEntry.innerHTML.includes('Bot is typing...')) lastEntry.remove();

  appendMessage(botResponse, 'bot');

  // Text-to-Speech
  if ('speechSynthesis' in window) {
    const utterance = new SpeechSynthesisUtterance(botResponse);
    speechSynthesis.speak(utterance);
  }
}

function startVoiceInput() {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'en-US';
  recognition.start();

  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    document.getElementById('userInput').value = transcript;
  };

  recognition.onerror = function(event) {
    alert('Voice input error: ' + event.error);
  };
}
</script>
</body>
</html>