{% extends "base.html" %}

{% block title %}Chat - {{ post.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Chat for: {{ post.title }}</h2>
    <p>
        {{ post.farmer.username if current_user.role == Role.COMPANY else "Company" }}
    </p>

    <!-- Messages -->
    <div class="border p-3 mb-3" style="height: 300px; overflow-y: auto;">
        {% for message in messages %}
            <div class="mb-2 {% if message.sender_id == current_user.id %}text-end{% endif %}">
                <strong>
                    {{ message.sender.username }}
                </strong>: {{ message.content }}
                <small class="text-muted d-block">{{ message.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</small>
            </div>
        {% else %}
            <p class="text-muted">No messages yet.</p>
        {% endfor %}
    </div>

    <!-- Send message form -->
    <form method="POST" class="d-flex">
        {{ form.hidden_tag() }}
        {{ form.content(class_="form-control me-2", placeholder="Type your message...") }}
        {{ form.submit(class_="btn btn-primary") }}
    </form>
</div>
{% endblock %}
